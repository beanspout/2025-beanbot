<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" itemscope itemtype="https://schema.org/WebPage">
<head>
<title>Calculations in Test Manager</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="docs_manual.css">
</head>
<body><script type="text/javascript" src="highlight.js"></script>
<script type="text/javascript">
	function highlightStart() { highlight(); }
	document.body.onload = highlightStart;
</script>

<div id="header">
	<div class="logo"><a href ="Top.html"><img src="ADT_LOGO.png" width="100" height="54" alt="A&amp;D Technology"/></a></div>
	<div class="name">iTest User's Guide</div>
	<div id="search-div">
		<form method="get" action="search.html">
			<input type="text" name="zoom_query" size="20" />
			<input type="submit" class="searchbutton" value="Search" />
		</form>
	</div>
</div>
<div class="clear"></div>
<div class="line-blue"></div><ul id="breadcrumb" >
<li><a href="Top.html">Home</a></li>
<li><a href="Developer_Tools.html">Developer Tools</a></li>
<li><a href="Calculations_in_Test_Manager.html">Calculations in Test Manager</a></li>
</ul>
</div>

<div class="trail"></div>

<a name="Test-Manager-Calculations"></a>
<h1 >Test Manager Calculations<a href="#Test-Manager-Calculations" class="wiki-anchor">&para;</a></h1>


	<ul class="toc right"><li><strong>Table of contents</strong></li><li><a href="#Test-Manager-Calculations">Test Manager Calculations</a><ul><li><a href="#Overview">Overview</a></li><li><a href="#Continuous-Calculations">Continuous Calculations</a><ul><li><a href="#Calculation-Rates">Calculation Rates</a></li><li><a href="#Syntax">Syntax</a></li><li><a href="#Creating-New-Calculations">Creating New Calculations</a></li></ul>
</li><li><a href="#Dynamic-Calculations">Dynamic Calculations</a><ul><li><a href="#Adding-the-Dynamic-Calculations-Folder">Adding the Dynamic Calculations Folder</a></li><li><a href="#Creating-New-Dynamic-Calculations">Creating New Dynamic Calculations</a><ul><li><a href="#Editing-Formulas">Editing Formulas</a></li></ul>
</li><li><a href="#Activating-Dynamic-Calculations">Activating Dynamic Calculations</a></li><li><a href="#Saving-Dynamic-Calculations">Saving Dynamic Calculations</a></li></ul>
</li><li><a href="#Ordering-Calculations">Ordering Calculations</a><ul><li><a href="#Ordering-Module-Calculations">Ordering Module Calculations</a></li></ul></li></ul></li></ul>


	<a name="Overview"></a>
<h2 >Overview<a href="#Overview" class="wiki-anchor">&para;</a></h2>


	<p>Calculations are a series of periodically calculated formulas. The calculated results are stored as channel values that can be logged, displayed, verified for limits and quality, and more. The following sections describe how to use Test Manager to create and edit calculations. For more information, reference the <a class="wiki-page" href="Calculations.html">Calculations</a> documentation.</p>


	<p><a name="Continuous-Calculations"></a>
<h2 >Continuous Calculations<a href="#Continuous-Calculations" class="wiki-anchor">&para;</a></h2>


	<p>Continuous calculations begin as soon as iTest is initialized and continue until the system is exited. Calculations are stored in separate files within folders that represent the rate of calculations. The following calculation folders are available, by default:</p>


	<ul>
	<li>1 Hz</li>
		<li>10 Hz</li>
		<li>100 Hz</li>
		<li>System Rate</li>
	</ul>


	<p>For the 1000 Hz calculation folder to appear, the <code>Support1kHz</code> <em>powertek.ini</em> setting must be set to TRUE.</p>


	<a name="Calculation-Rates"></a>
<h3 >Calculation Rates<a href="#Calculation-Rates" class="wiki-anchor">&para;</a></h3>


	<p>By default, iTest calculations are supported at the following rates: 1 Hz, 10 Hz, 100 Hz, or system rate. To support calculations at a rate up to 1000 Hz, the <code>Support1kHz</code> <em>powertek.ini</em> option must be set to TRUE, and it must be running on a dedicated machine with a real-time operating system. A special task executes and enables the scanning of PIDs, logging, and calculations at rates up to 1000 Hz.</p>


	<p>Calculations are executed in the following priority:</p>


	<ol>
	<li>1000 Hz</li>
		<li>System Rate</li>
		<li>100 Hz</li>
		<li>10 Hz</li>
		<li>1 Hz</li>
	</ol>


	<p><table>
		<tr>
			<td style="background:#ebd700;"></td>
			<td style="vertical-align:top;"><img src="attachments/download/3740/caution.gif" alt="" /></td>
			<td style="vertical-align:top;"><b>CAUTION:</b></td>
			<td style="vertical-align:top;">Calculations running at 1000 Hz have the potential to slow the system. Calculations that involve strings are CPU intensive and should be calculated at 10 Hz or 1 Hz.</td>
		</tr>
	</table></p>


	<a name="Syntax"></a>
<h3 >Syntax<a href="#Syntax" class="wiki-anchor">&para;</a></h3>


	<p>Calculations use the following format:<br /><pre>
&lt;ChannelName&gt; &lt;Formula&gt;
</pre><br />The destination channel name and expression must be separated by a blank space character. This character is an implied equal sign; you do not need to include an equal sign between the channel name and the expression.</p>


	<p><table>
		<tr>
			<td style="background:#336699;"></td>
			<td style="vertical-align:top;"><img src="attachments/download/3553/Notepad.png" alt="" /></td>
			<td style="vertical-align:top;"><b>NOTE:</b></td>
			<td style="vertical-align:top;">A single line in the Calculations editor cannot exceed 1023 bytes.</td>
		</tr>
	</table></p></p>


	<a name="Creating-New-Calculations"></a>
<h3 >Creating New Calculations<a href="#Creating-New-Calculations" class="wiki-anchor">&para;</a></h3>


	<p>You can create new calculations in Test Manager's tree bar. Calculations are maintained in the <em>Calculations</em> folder.</p>


	<p>To create a new calculation, do the following:</p>


	<ol>
	<li>Expand the <em>Calculations</em> folder.</li>
		<li>Expand the folder for the rate you want the calculation to run (1 Hz, 10Hz, or 100Hz).</li>
		<li>Right-click the folder and select the <strong>New (Num)HzCalc</strong> option. A new <em>.dat</em> file is added to the folder and a blank calculation sheet displays in the editor.<br />&nbsp;<br /><span style="font-size: 11px;padding-left: 1.5em;"> <em><strong>Adding a New Calculation</strong></em></span><br /><img src="attachments/download/27942/NewNumHz.png" style="padding-top:0.5em;padding-bottom:1em;padding-left:1em;" alt="" /><br />&nbsp;<br /><span style="font-size: 11px;padding-left: 1.5em;"> <em><strong>New Calculation Editor</strong></em></span><br /><img src="attachments/download/27951/NewCalculationSheet.png" style="padding-top:0.5em;padding-bottom:1em;padding-left:1em;" alt="" /><br />&nbsp;</li>
	</ol>


	<p>To create your own calculations, use the editor and enter an existing channel name, followed by a blank space character, followed by a formula. You may also use the helper bar to drag functions, channel names, and operators into the calculation editor. For more information about VCL functions that can be used in your calculations, use the following reference guides for assistance:</p>


	<ul>
	<li><a class="wiki-page" href="VCL_Function_List.html">VCL Function List</a></li>
		<li><a class="wiki-page" href="VCL_Math_and_Conversion_Functions.html">VCL Math and Conversion Functions</a></li>
		<li><a class="wiki-page" href="VCL_Miscellaneous_Functions.html">VCL Miscellaneous Functions</a></li>
	</ul>


	<table>
		<tr>
			<td style="background:#336699;"></td>
			<td style="vertical-align:top;"><img src="attachments/download/3553/Notepad.png" alt="" /></td>
			<td style="vertical-align:top;"><b>NOTE:</b></td>
			<td style="vertical-align:top;">The use of <code>#if</code> logic is supported in calculations; however, <code>while loop</code> functionality is not permitted.</td>
		</tr>
	</table>




	<p>The following image is an example of the calculation editor used to define a series of assignments and logical statements:<br />&nbsp;<br /><span style="font-size: 11px;padding-left: 3em;"> <em><strong>10 Hz Calculation Example</strong></em></span><br /><img src="attachments/download/42707/iTest38_Calculations.png" style="padding-top:0.5em;padding-bottom:1em;padding-left: 2.30em;" alt="" /><br />&nbsp;</p>


	<a name="Dynamic-Calculations"></a>
<h2 >Dynamic Calculations<a href="#Dynamic-Calculations" class="wiki-anchor">&para;</a></h2>


	<p>Dynamic calculations run independently and asynchronously to the real-time system as they are processed by separate executables. This enables you to perform modifications to the calculation file while it is actively running without affecting the system or causing a full rebuild. Test Manager and SolutionBuilder support the creation of multiple dynamic calculation files, but only ten may be active at a given time. The <em>CalcEngine</em> application executes the dynamic calculations and processes them at system scan rate.</p>


	<p>Dynamic calculations support the following channel types:</p>


	<ul>
	<li>Virtual Output</li>
		<li>Analog Input</li>
		<li>Analog Output</li>
		<li>Digital Output</li>
		<li>PWM Output</li>
	</ul>


	<p><table>
		<tr>
			<td style="background:#336699;"></td>
			<td style="vertical-align:top;"><img src="attachments/download/3553/Notepad.png" alt="" /></td>
			<td style="vertical-align:top;"><b>NOTE:</b></td>
			<td style="vertical-align:top;">The use of string channels is not supported.</td>
		</tr>
	</table></p>


	<p>To use dynamic calculations, the CalcEngine application can be configured to initiate upon startup. To do so, edit the <em>powertek.ini</em> file in the $SUPPORTDIR with the following additions:</p>


	<p style="font-size: 11px;margin-left: 3em;"><em><strong>CalcEngine Configuration Settings</strong></em></p>


	<table style="margin-left: 2.5em;">
		<tr style="padding-bottom:1em;background:#cccaca;">
			<td style="width:120px;text-align:left;"><strong>Operating System</strong> </td>
			<td style="text-align:left;"><strong>Description</strong> </td>
		</tr>
		<tr>
			<td>Windows</td>
			<td>Add \\calcengine.exe>> to the <code>Preload=</code> entry.</td>
		</tr>
		<tr>
			<td>INtime</td>
			<td> Add\\calcengine.rta>> to the <code>RTxPreload=</code> entry.</td>
		</tr>
	</table>




	<p>For INtime, the name used is dependent on the system version. For more information, refer to the <a class="wiki-page" href="INtime_Extensions.html">INtime Extensions</a> documentation to determine which RTA file to use. For INtime >= 4.2, specify the CPU node on which to run (e.g., <em>\\CalcEngine.rta -nNodeA>></em>). <em>CalcEngine.rta</em> may be (re)started with a mailslot to data_engine (e.g., "CalcEngine Start" or "CalcEngine Start -nNodeA").</p></p>


	<a name="Adding-the-Dynamic-Calculations-Folder"></a>
<h3 >Adding the Dynamic Calculations Folder<a href="#Adding-the-Dynamic-Calculations-Folder" class="wiki-anchor">&para;</a></h3>


	<p>If the <em>Dynamic Calculations</em> folder is not present in Test Manager, it must be added to the <em>moduledefinition.xml</em> file located in the $SUPPORTDIR. Open the <em>moduledefinition.xml</em> file, and enter the following line in the <code>System</code> type section:</p>


<pre>&lt;folder&gt;Dynamic Calculations&lt;/folder&gt;</pre>

	<p>&nbsp;<br /><span style="font-size: 11px;padding-left: 3em;"> <em><strong>Adding the Dynamic Calculations Folder</strong></em></span><br /><img src="attachments/download/45817/38_AddDynamicCalcFolder.png" style="padding-top:0.5em;padding-bottom:1em;padding-left: 2.30em;" alt="" /><br />&nbsp;</p>


	<a name="Creating-New-Dynamic-Calculations"></a>
<h3 >Creating New Dynamic Calculations<a href="#Creating-New-Dynamic-Calculations" class="wiki-anchor">&para;</a></h3>


	<p>Dynamic Calculations are edited and created in Test Manager. If the <em>Dynamic Calculations</em> folder is not visible, refer to the <a class="wiki-page" href="Calculations.html#Adding-the-Dynamic-Calculations-Folder">Adding the Dynamic Calculations Folder</a> section above.</p>


	<p>To create a new dynamic calculation, do the following:</p>


	<ol>
	<li>Expand the <em>Calculations</em> folder.</li>
		<li>Locate the <em>Dynamic Calculations</em> sub-folder. Right-click the folder name to create a new dynamic calculation.<br />&nbsp;<br /><span style="font-size: 11px;padding-left: 1.5em;"> <em><strong>Dynamic Calculations Folder</strong></em></span><br /><img src="attachments/download/92050/DynamicCalculations.png" style="padding-top:0.5em;padding-bottom:1em;padding-left:1em;" alt="" /><br />&nbsp;</li>
		<li>The Dynamic Calculation editor populates the Test Manager display. Right-click within the editor.</li>
		<li>Click <strong>Add to end</strong> or <strong>Insert before</strong>. A new row for your calculation displays.</li>
	</ol>


	<p>You can define your dynamic calculation using the columns: <strong>Customer Name</strong>, <strong>Alias</strong>, <strong>Units</strong>, and <strong>Formula</strong>.<br />&nbsp;<br /><span style="font-size: 11px;padding-left: 3em;"> <em><strong>New Dynamic Calculation File</strong></em></span><br /><img src="attachments/download/27959/NewDynamicCalc.png" style="padding-top:0.5em;padding-bottom:1em;padding-left: 2.30em;" alt="" /><br />&nbsp;</p>


	<p>Dynamic calculations support <code>#if</code> logic embedded into the formula string for an individual calculation. The syntax is as follows:</p>


<pre>#if (condition) \ntrue_result\n#endif
</pre>

	<p>or</p>


<pre>#if (condition) \ntrue_result\n#else\nfalse_result\n#endif
</pre>

	<p><strong>Where</strong>: "\n" delimits the statements</p>


	<table>
		<tr>
			<td style="background:#ebd700;"></td>
			<td style="vertical-align:top;"><img src="attachments/download/3740/caution.gif" alt="" /></td>
			<td style="vertical-align:top;"><b>CAUTION:</b></td>
			<td style="vertical-align:top;"><code>#elseif</code> statements and nested <code>#if/#else</code> statements are <ins><strong>not</ins></strong> supported.</td>
		</tr>
	</table>




	<p>&nbsp;</p>


	<a name="Editing-Formulas"></a>
<h4 >Editing Formulas<a href="#Editing-Formulas" class="wiki-anchor">&para;</a></h4>


	<p>The Edit Formula dialog is a feature that allows you to conveniently input formulas into dynamic calculations. To access this dialog, right-click the Formula column in the row you want to edit, then select <strong>Edit Formula</strong>. <br />&nbsp;<br /><span style="font-size: 11px;padding-left: 3em;"> <em><strong>Edit Formula Dialog</strong></em></span><br /><img src="attachments/download/108085/42_EditFormula.png" style="padding-top:0.5em;padding-bottom:1em;padding-left: 2.30em;" alt="" /><br />&nbsp;</p>


	<p>The Edit Formula dialog will display:<br />&nbsp;<br /><span style="font-size: 11px;padding-left: 3em;"> <em><strong>Edit Formula Dialog</strong></em></span><br /><img src="attachments/download/108086/42_EditFormulaDialog.png" style="padding-top:0.5em;padding-bottom:1em;padding-left: 2.30em;" alt="" /><br />&nbsp;</p>


	<p style="font-size: 11px;margin-left: 3em;"><em><strong>Edit Formula Dialog Buttons</strong></em></p>


	<table style="margin-left: 2.5em;width:800px;">
		<tr style="padding-bottom:1em;background:#cccaca;">
			<td style="width:100px;text-align:left;"><strong>Button</strong> </td>
			<td style="text-align:left;"><strong>Description</strong> </td>
		</tr>
		<tr>
			<td>Insert Function</td>
			<td>Inserts a function selected from the drop-down menu. Upon selecting a function, a description of that function will display below the menu. <br />&nbsp;<br /><img src="attachments/download/108087/42_functions.png" alt="" /></td>
		</tr>
		<tr>
			<td>Insert Channel</td>
			<td>Launches the Channel Select dialog.</td>
		</tr>
		<tr>
			<td>Check Syntax</td>
			<td>Verifies the formula's syntax. If selected, a pop-up will appear to indicate an error or confirm the syntax has passed.</td>
		</tr>
	</table>




	<p>To load changes from the dialog to the table, click <strong>OK</strong>. To exit out of the dialog without saving changes, click <strong>Cancel</strong>.</p></p>


	<a name="Activating-Dynamic-Calculations"></a>
<h3 >Activating Dynamic Calculations<a href="#Activating-Dynamic-Calculations" class="wiki-anchor">&para;</a></h3>


	<p>To activate a calculation, right-click the <em>Dynamic Calculation</em> file, and select the <strong>Active</strong> menu option. When iTest is initialized, the active calculation file is automatically compiled and executed.<br />&nbsp;<br /><span style="font-size: 11px;padding-left: 3em;"> <em><strong>Activating the Dynamic Calculation File</strong></em></span><br /><img src="attachments/download/27961/ActiveDynamicCalculation.png" style="padding-top:0.5em;padding-bottom:1em;padding-left: 2.30em;" alt="" /><br />&nbsp;</p>


	<a name="Saving-Dynamic-Calculations"></a>
<h3 >Saving Dynamic Calculations<a href="#Saving-Dynamic-Calculations" class="wiki-anchor">&para;</a></h3>


	<p>When dynamic calculations are saved, the formulas and fields are parsed for accuracy prior to saving. An error will cause a message to generate within the output bar <em>or</em> it may display in a separate dialog describing formula errors. These syntax errors prohibit the dynamic calculations from being saved.</p>


	<p>To save your dynamic calculation file, right-click the file name and select the <strong>Save</strong> menu option.<br />&nbsp;<br /><span style="font-size: 11px;padding-left: 3em;"> <em><strong>Saving the Dynamic Calculation File</strong></em></span><br /><img src="attachments/download/27963/SaveDynamicCalc.png" style="padding-top:0.5em;padding-bottom:1em;padding-left: 2.30em;" alt="" /><br />&nbsp;</p>


	<p><a name="Ordering-Calculations"></a>
<h2 >Ordering Calculations<a href="#Ordering-Calculations" class="wiki-anchor">&para;</a></h2>


	<p>You can change the order that calculations are executed within a calculation rate folder. This enables you to have a finer control over the order that the files are run. Calculations can only be ordered within a specific rate. In other words, you cannot order 10 Hz and 100 Hz calculations. <br />To modify the calculation order for a specific folder rate, right-click on a folder and select Order Calculations. This opens the Calculation Order dialog, where you can drag and drop the calculation files to reorder when the calculations are executed.</p>


	<p><span style="font-size: 11px;padding-left: 3em;"> <em><strong>Ordering Calculations</strong></em></span><br /><img src="attachments/download/117204/43_OrderCalculations.gif" style="padding-top:0.5em;padding-bottom:1em;padding-left: 2.30em;" alt="" /></p>


	<p>When finished, click <strong>OK</strong>. Note that the new order is not reflected visually in the list of calculations.</p>


	<a name="Ordering-Module-Calculations"></a>
<h3 >Ordering Module Calculations<a href="#Ordering-Module-Calculations" class="wiki-anchor">&para;</a></h3>


	<p>In addition to the manual reordering of your solution’s calculations, module calculations can be controlled by defining the process order value of each module. A lower process order number places the module’s calculations earlier in the calculation loop. By default, new modules have a process order of 2 and the calculations in the system module have an order of 1. Without adjusting these values, the calculations in the base system occur prior to the calculations in the modules.</p>


	<table>
		<tr>
			<td style="background:#336699;"></td>
			<td style="vertical-align:top;"><img src="attachments/download/3553/Notepad.png" alt="" /></td>
			<td style="vertical-align:top;"><b>NOTE:</b></td>
			<td style="vertical-align:top;">If two modules have the same order, the order by which they are processed is indeterminate.</td>
		</tr>
	</table>




	<p>&nbsp;</p></p>
</body>
</html>
